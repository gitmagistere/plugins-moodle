define(["jquery","mod_coursebadges/jtable"],function(a){function b(b,c,d,e){b=a('input[name="'+b+'"]').val(),b=JSON.parse(b),b.imgurl&&(b.imgurl.display=function(a){return a.record.badgeurl?'<a href="'+a.record.badgeurl+'"><img class="cb_overviewbadge" src="'+a.record.imgurl+'"/></a>':'<img class="cb_overviewbadge" src="'+a.record.imgurl+'"/>'}),b.modname&&(b.modname.display=function(a){for(var b=a.record,c="",d=0;d<b.modnames.length;d++)c+=b.modnames[d].name+"<br/>";return c}),b.percent&&(b.percent.display=function(a){var b=a.record;return b.urlearnedbadge&&b.urlselectedbadge?'<p><a href="'+b.urlearnedbadge+'">'+b.badgeearnedcount+'</a>/<a href="'+b.urlselectedbadge+'">'+b.badgetotal+"</a> ("+b.badgepercent+"%)</p>":"<p>"+b.badgeearnedcount+"/"+b.badgetotal+" ("+b.badgepercent+"%)</p>"}),b.groupnames&&(b.groupnames.display=function(a){for(var b=a.record,c="",d=0;d<b.groupnames.length;d++)c+=b.groupnames[d].name+"<br/>";return c}),b.earnedbadges&&(b.earnedbadges.display=function(a){for(var b=a.record,c="",d=0;d<b.earnedbadges.length;d++)c+=b.earnedbadges[d].badge_url?'<a href="'+b.earnedbadges[d].badge_url+'"><img class="cb_overviewbadge_mini" src="'+b.earnedbadges[d].img_url+'"/></a>':'<img class="cb_overviewbadge_mini" src="'+b.earnedbadges[d].img_url+'"/>';return c}),b.selectedbadges&&(b.selectedbadges.display=function(a){for(var b=a.record,c="",d=0;d<b.selectedbadges.length;d++)c+=b.selectedbadges[d].badge_url?'<a href="'+b.selectedbadges[d].badge_url+'"><img class="cb_overviewbadge_mini" src="'+b.selectedbadges[d].img_url+'"/></a>':'<img class="cb_overviewbadge_mini" src="'+b.selectedbadges[d].img_url+'"/>';return c});var f=a("#"+c).jtable({paging:!0,pageSize:10,pageSizes:[10,25,50,100],selecting:!1,multiselect:!1,sorting:!0,defaultSorting:e,jqueryuiTheme:!0,defaultDateFormat:"dd-mm-yy",gotoPageArea:"none",actions:{listAction:function(b,c){return a.Deferred(function(e){b=a("#mform1").serialize(),a.ajax({url:d+"&si="+c.jtStartIndex+"&ps="+c.jtPageSize+"&so="+c.jtSorting,type:"POST",dataType:"json",data:b,success:function(a){e.resolve(a)},error:function(){e.reject()}})})}},fields:b});f.jtable("load")}function c(){a("#mform1 select").change(function(){a("#results").jtable("load")})}function d(b){var c;a('#mform1 input[name="'+b+'"]').on("keyup",function(){clearTimeout(c),c=setTimeout(function(){a("#results").jtable("load")},500)})}return{initJtable:b,initSelectOverview:c,initNameInput:d}});