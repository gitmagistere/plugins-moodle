define(["block_summary/nestable","block_summary/tooltipster","jqueryui"],function(){function a(a,b,c,d,e){var f=a,g=b,h=!1,i=[];$(".dd").nestable({maxDepth:2,handleClass:"dd-itemdiv",expandBtnHTML:"",collapseBtnHTML:"",onDragStart:function(a,b,c){var d=$(b).find(".dd-div").first(),d=$(b).find(".dd-div").first(),e=d.offset(),f=d.width(),g=d.height();if(c.left<e.left||c.left>e.left+f||c.top<e.top||c.top>e.top+g)return!1},beforeDragStop:function(){h=!0}}),$(".ishidden").parents("div.dd-itemdiv").addClass("hideClass"),$(".dd").on("click",".hide",function(){$(this).hasClass("ishidden")?($(this).toggleClass("ishidden",!1),$(this).addClass("fa-eye"),$(this).removeClass("fa-eye-slash"),$(this).tooltipster("content",$("<span>Masquer la section</span>")),$(this).parents("div.dd-itemdiv").removeClass("hideClass")):($(this).toggleClass("ishidden",!0),$(this).removeClass("fa-eye"),$(this).addClass("fa-eye-slash"),$(this).tooltipster("content",$("<span>Afficher la section</span>")),$(this).parents("div.dd-itemdiv").addClass("hideClass")),h=!0}),$("#addsection").on("click",function(a){a.preventDefault(),$("#dd>ol").append('<li class="dd-item" data-id="'+f+'"><div class="dd-itemdiv"><div class="dd-div">'+c+"</div>"+d+'<div class="dd-handle">Nouvelle section ('+g+')</div><div class="dd-buttonsblock">'+e+"</div></div></li>"),f+=1,g+=1;var b={maxWidth:620,position:"bottom-right",timer:3e3};b.content=$("<span>Edition du titre de la section</span>"),$(".edit").tooltipster(b),b.content=$("<span>Masquer la section</span>"),$(".hide:not(.ishidden)").tooltipster(b),b.content=$("<span>Afficher la section</span>"),$(".ishidden").tooltipster(b),b.content=$("<span>Suppression de la section</span>"),$(".del").tooltipster(b),b.content=$("<span>Déplacer la section</span>"),$(".move").tooltipster(b),h=!0}),$("#dd").on("click",".del",function(){var a=$(this);$("#dialog-confirm").dialog({resizable:!1,height:"auto",width:600,modal:!0,buttons:{"Supprimer la section":function(){a.parents("li").first().find(".dd-handle").toArray().map(function(a){return i.push(a.textContent)}),a.parents("ol").first().children().length<=1&&$(".dd").nestable("unsetParent",a.parents("ol").first().parents("li").first()),a.parents("li").first().remove(),$(this).dialog("close")},Annuler:function(){$(this).dialog("close")}}}),h=!0}),$(".dd").on("keyup",".editinput",function(a){13==a.keyCode&&$(this).trigger("focusout"),h=!0}),$(".dd").on("focusout",".editinput",function(){var a=$(this).parent(),b=a.parent().children(".dd-buttonsblock").children(".edit");b.removeClass("fa-check"),b.addClass("fa-pencil");var c=a.children().first().val();a.empty(),a.append(c),h=!0}),$(".dd").on("click",".edit",function(){var a=$(this).parents("li"),b=a.first().children(".dd-itemdiv").first().children(".dd-handle").first(),c=a.attr("data-id");if($(this).hasClass("fa-pencil")){$(this).removeClass("fa-pencil"),$(this).addClass("fa-check");var d=$.trim(b.text()),e=$("<input>");e.attr("class","editinput"),e.attr("id",c+"_input"),e.attr("value",d),e.css({"z-index":897456}),e.attr("type","text"),b.empty(),b.append(e),b.find("#"+c+"_input").focus()}else{$(this).removeClass("fa-check"),$(this).addClass("fa-pencil");var d=b.children().first().val();b.empty(),b.append(d)}h=!0}),$("#save").on("click",function(a){a.preventDefault();for(var b=$(".dd").nestable("serialize"),c=0;c<b.length;c++){var d=$("li[data-id='"+b[c].id+"']> .dd-itemdiv .ishidden").length;b[c].hidden=!!d;var e=$("li[data-id='"+b[c].id+"']> .dd-itemdiv .dd-handle").text();if(b[c].name=e,b[c].children&&b[c].children.length)for(var f=b[c].children,g=0;g<f.length;g++){var d=$("li[data-id='"+f[g].id+"'] .dd-itemdiv .ishidden").length;f[g].hidden=!!d;var e=$("li[data-id='"+f[g].id+"'] .dd-itemdiv .dd-handle").text();f[g].name=e}}if(h=!1,$("#treedata").val(JSON.stringify(b)),$("#isSubmited").val(!0),i.length>0){for($("#dialog-confirm-save-list").empty(),c=0;c<i.length;c++)$("#dialog-confirm-save-list").append("<li>"+i[c]+"</li>");$("#dialog-confirm-save").dialog({resizable:!1,height:"auto",maxHeight:400,width:600,modal:!0,buttons:{Valider:function(){h=!1,$("#form").submit(),$(this).dialog("close")},Annuler:function(){$(this).dialog("close")}}}),$(".ui-dialog-buttonset > button:last").focus(),h=!0}else $("#form").submit()});var j={maxWidth:620,position:"bottom-right",timer:3e3};j.content=$("<span>Edition du titre de la section</span>"),$(".edit").tooltipster(j),j.content=$("<span>Masquer la section</span>"),$(".hide:not(.ishidden)").tooltipster(j),j.content=$("<span>Afficher la section</span>"),$(".ishidden").tooltipster(j),j.content=$("<span>Suppression de la section</span>"),$(".del").tooltipster(j),j.content=$("<span>Déplacer la section</span>"),$(".move").tooltipster(j),$(window).on("beforeunload",function(a){if(h)return a=a||window.event,a&&(a.returnValue="There is some unsaved changes!"),"There is some unsaved changes!"})}return{init:function(b,c,d,e,f){a(b,c,d,e,f)}}});