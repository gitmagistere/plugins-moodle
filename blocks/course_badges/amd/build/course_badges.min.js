define(["jquery","block_course_badges/jtable"],function(a){function b(){var b=3;a(window).width()<1920&&a(window).width()>1441?b=2:a(window).width()<1441&&a(window).width()>=1118?b=1:a(window).width()<1118&&a(window).width()>=768?b=0:a(window).width()<768&&a(window).width()>=425?b=4:a(window).width()<425&&a(window).width()>320?b=2:a(window).width()<=320&&(b=1),b=2*b+1,a(".badgescontent").each(function(c,d){a(d).children(".bcb_badge").length<=b&&a(d).children(".showmore").hide(),a(d).children(".bcb_badge:gt("+(b-1)+")").hide()}),a(".showmore").click(function(){a(this).parent().children(".bcb_badge").show(),a(this).remove()})}function c(b,c,d,e){var b=a('input[name="'+b+'"]').val();b=JSON.parse(b),b.imgurl&&(b.imgurl.display=function(a){return a.record.badgeurl?'<a href="'+a.record.badgeurl+'"><img class="cb_overviewbadge" src="'+a.record.imgurl+'"/></a>':'<img class="cb_overviewbadge" src="'+a.record.imgurl+'"/>'}),b.modname&&(b.modname.display=function(a){for(var b=a.record,c="",d=0;d<b.modnames.length;d++)c+=b.modnames[d].coursebadgeurl?'<a href="'+b.modnames[d].coursebadgeurl+'">'+b.modnames[d].name+"</a><br/>":b.modnames[d].name+"<br/>";return c}),b.percent&&(b.percent.display=function(a){var b=a.record;return b.urlearnedbadge&&b.urlselectedbadge?'<p><a href="'+b.urlearnedbadge+'">'+b.badgeearnedcount+"</a>/<a href="+b.urlselectedbadge+">"+b.badgetotal+"</a> ("+b.badgepercent+"%)</p>":"<p>"+b.badgeearnedcount+"/"+b.badgetotal+" ("+b.badgepercent+"%)</p>"}),b.groupnames&&(b.groupnames.display=function(a){for(var b=a.record,c="",d=0;d<b.groupnames.length;d++)c+=b.groupnames[d].name+"<br/>";return c}),b.earnedbadges&&(b.earnedbadges.display=function(a){for(var b=a.record,c="",d=0;d<b.allearnedbadgeids.length;d++)c+=b.allearnedbadgeids[d].badge_url?'<a href="'+b.allearnedbadgeids[d].badge_url+'"><img class="cb_overviewbadge_mini" src="'+b.allearnedbadgeids[d].img_url+'"/></a>':'<img class="cb_overviewbadge_mini" src="'+b.allearnedbadgeids[d].img_url+'"/>';return c}),b.selectedbadges&&(b.selectedbadges.display=function(a){for(var b=a.record,c="",d=0;d<b.selectedbadges.length;d++)c+=b.selectedbadges[d].badge_url?'<a href="'+b.selectedbadges[d].badge_url+'"><img class="cb_overviewbadge_mini" src="'+b.selectedbadges[d].img_url+'"/></a>':'<img class="cb_overviewbadge_mini" src="'+b.selectedbadges[d].img_url+'"/>';return c});var f=a("#"+c).jtable({paging:!0,pageSize:10,pageSizes:[10,25,50,100],selecting:!1,multiselect:!1,sorting:!0,defaultSorting:e,jqueryuiTheme:!0,defaultDateFormat:"dd-mm-yy",gotoPageArea:"none",actions:{listAction:function(b,c){return a.Deferred(function(e){b=a("#mform1").serialize(),a.ajax({url:d+"&si="+c.jtStartIndex+"&ps="+c.jtPageSize+"&so="+c.jtSorting,type:"POST",dataType:"json",data:b,success:function(a){e.resolve(a)},error:function(){e.reject()}})})}},fields:b});f.jtable("load")}function d(){a("#mform1 select").change(function(){a("#results").jtable("load")})}function e(b){var c;a('#mform1 input[name="'+b+'"]').on("keyup",function(){clearTimeout(c),c=setTimeout(function(){a("#results").jtable("load")},500)})}function f(){a('div[class^="block_course_badges"] h3').click(function(){a(this).next().toggle()})}function g(b){b="."+b;var c=b+" .options",d=b+" .option-selected";a(b+" .option-selected-arrow, "+d).click(function(){a(b+" .option-selected-arrow").toggleClass("expand"),a(d+", "+b+" .option-selected-arrow").toggleClass("focus"),a(c).toggle()}),a(b+" .option label").click(function(){var b=a(this).closest(".option"),e=b.find("label").html();a(d).html(e),a(c+" .option.selected").removeClass("selected"),b.addClass("selected"),b.closest(".options").find("input").removeAttr("checked"),b.find("input").attr("checked","checked"),a(c).hide(),a("#mform1").submit()}),a("body").click(function(e){if(a(c).is(":visible")){var f={left:e.pageX,top:e.pageY},g=a(c).position();g.left+=a(c).offset().left;var h=a(d).position();h.top+=a(d).offset().top;var i=a(c).width(),j=a(c).height(),k={top:h.top,left:g.left},l={top:k.top+j,left:k.left+i};f.top>=k.top&&f.top<=l.top&&f.left>=k.left&&f.left<=l.left||(a(c).hide(),a(d+", "+b+" .option-selected-arrow").removeClass("focus"))}})}return{init_show_more:b,init_block_header:f,init_jtable:c,init_select_overview:d,init_name_input:e,init_custom_select:g}});