{"version":3,"sources":["../src/wordcloud.js"],"names":["define","$","str","wordclouds","delaystep","svgminheight","svgmaxheight","apiurl","fill","d3","scale","category20","showWordcloud","cmid","selector","api_url","editor","wordCloud","width","_selector","height","displaymod","parent","editing","isediting","editingword","resizetimer","updatetimer","updatedelay","lastupdate","words","wordsrender","wcwidth","parents","borderwidth","currentgroupid","svg","select","append","attr","length","switch_display","find","changegroup","val","listeners","on","bind","window","resize","clearTimeout","setTimeout","split","exportPNG","exportData","addWord","e","key","which","click","event","loadWordEdit","target","text","updateWord","removeWord","closeWordEdit","cloud","selectAll","data","d","enter","style","Math","random","transition","duration","size","x","y","rotate","exit","remove","JSON","parse","stringify","layout","padding","font","fontSize","draw","start","update_svg","groupid","newurl","location","protocol","host","pathname","history","replaceState","path","document","title","update_wordcloud","ajax","type","url","dataType","success","response","error","mod","show","hide","is","html","force","noupdate","subs","get_string","then","value","timemodified","form","preventDefault","t","createElement","getContext","translate","forEach","save","PI","textAlign","fillStyle","toLowerCase","fillText","restore","a","href","toDataURL","replace","download","URL","Blob","atob","blob","base64ToBlob","createObjectURL","revokeObjectURL","prop","word","focus","addClass","weight","ul","users","each","idx","slideUp","slideDown","removeClass","newword","base64","mimetype","slicesize","Uint8Array","bytechars","bytearrays","offset","slice","bytenums","Array","i","charCodeAt","bytearray"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle wordcloud display.\n *\n * @module     mod_wordcloud\n * @package    mod_wordcloud\n * @copyright  2021 TCS\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/str'], function($,str) {\n\tvar wordclouds = [];\n\tvar delaystep = 2000;\n\tvar mindelay = 2000;\n\tvar maxdelay = 60000;\n\tvar svgminheight = 350;\n\tvar svgmaxheight = 600;\n\tvar apiurl = '';\n\tvar fill = d3.scale.category20();\n\t\n\tfunction showWordcloud(cmid,selector,api_url,editor){\n\t\tapiurl = api_url;\n\t\t\n\t\twordclouds[cmid] = new wordCloud(cmid,selector,$(selector).width(),$(selector).width()*0.56,editor);\n\t\t\n\t\t//wordclouds[cmid].currentgroupid = 0;\n\t\t//wordclouds[cmid].updatedelay = mindelay;\n\t\t\n\t\t//wordclouds[cmid].update_wordcloud();\n\n\t\t\n\t}\n\t\n\t\n\tclass wordCloud {\n\t\t\n\t\tconstructor(cmid, _selector, width, height, editor) {\n\t\t\n\t\t\tthis.width = width;\n\t\t\tthis.height = height>svgmaxheight?svgmaxheight:(height<svgminheight?svgminheight:height);\n\t\t\t\n\t\t\tthis.displaymod;\n\t\t\tthis.cmid = cmid;\n\t\t\tthis.selector = _selector;\n\t\t\tthis.parent = $(_selector).parent();\n\t\t\t\n\t\t\tthis.editing = editor;\n\t\t\tthis.isediting = false;\n\t\t\tthis.editingword = '';\n\t\t\t\n\t\t\tthis.resizetimer;\n\t\t\tthis.updatetimer;\n\t\t\tthis.updatedelay = mindelay;\n\t\t\tthis.lastupdate = 0;\n\t\t\tthis.words = [];\n\t\t\tthis.wordsrender = [];\n\t\t\t\n\t\t\tthis.wcwidth = $(this.selector).parents('#region-main-box').width();\n\t\t\tthis.borderwidth = this.wcwidth - $(this.selector).width();\n\t\t\t\n\t\t    \n\t\t\tthis.currentgroupid = -1;\n\t\t    \n\t\t  //Construct the word cloud's SVG element\n\t\t\tthis.svg = d3.select(this.selector).append(\"svg\")\n\t\t    \t.attr(\"width\", this.width)\n\t\t        .attr(\"height\", this.height)\n\t\t        .append(\"g\")\n\t\t        .attr(\"transform\", \"translate(\"+(this.width/2)+\",\"+(this.height/2)+\")\");\n\t\t    \n\t\t\tvar svg = this.svg;\n\t\t\t\n\t\t\tif ($('#fitem_id_word_1').length > 0){\n\t\t\t\tthis.switch_display('f');\n\t\t\t}else{\n\t\t\t\tif (this.parent.find('.wc_groupselector').length > 0) {\n\t\t\t\t\tthis.changegroup(this.parent.find('.wc_groupselector').val());\n\t\t\t\t}else{\n\t\t\t\t\tthis.changegroup(0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.listeners();\n\t\t}\n\t\t\n\t\tlisteners () {\n\t\t\t\n\t\t\tif (this.parent.find('.wc_groupselector').length){\n\t\t\t\t\n\t\t\t\tthis.parent.find('.wc_groupselector').on('change', (function() {\n\t\t\t\t\tvar select = this.parent.find('.wc_groupselector');\n\t\t\t\t\tthis.changegroup(select.val());\n\t\t\t\t}).bind(this));\n\t\t\t}\n\n\t\t\t$( window ).resize((function() {\n\t\t\t\tif (this.displaymod=='c') {\n\t\t\t\t\tif (this.resizetimer != undefined){\n\t\t\t\t\t\tclearTimeout(this.resizetimer);\n\t\t\t\t\t}\n\t\t\t\t\tthis.resizetimer = setTimeout((this.resize).bind(this),500);\n\t\t\t\t}\n\t\t\t}).bind(this));\n\n\t\t\tif (this.editing) {\n\t\t\t\td3.select(this.selector.split(' ')[0]+' .wc_exportpng').on(\"click\",this.exportPNG.bind(this));\n\n\t\t\t\tthis.parent.on('click','.wc_exportdata',(function(){\n\t\t\t\t\tthis.exportData();\n\t\t\t\t}).bind(this));\n\t\t\t\t\n\t\t\t\tthis.parent.on('click','.wc_addword',(function(){\n\t\t\t\t\tthis.addWord(this);\n\t\t\t\t}).bind(this));\n\t\t\t\t\n\t\t\t\tthis.parent.on('keypress','input[name=wcaddword]',(function(e){\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tif(key == 13) {\n\t\t\t\t\t\t $(this.parent).find('.wc_addword').click();\n\t\t\t\t\t\t return false;  \n\t\t\t\t    }\n\t\t\t\t}).bind(this));\n\t\t\t\t\n\t\t    \t$(this.selector).on('click', 'svg text', (function(event){\n\t\t    \t\tif (!this.isediting) {\n\t\t    \t\t\tthis.loadWordEdit($(event.target).text())\n\t\t    \t\t}\n\t\t    \t}).bind(this));\n\t\t    \t\n\t\t    \tthis.parent.on('keypress','input[name=wceditword]',(function(e){\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tif(key == 13) {\n\t\t\t\t\t\t $(this.parent).find('.wc_updateword').click();\n\t\t\t\t\t\t return false;  \n\t\t\t\t    }\n\t\t\t\t}).bind(this));\n\t\t    \t\n\t\t    \t$(this.parent).on('click', '.wc_updateword', (function(event){\n\t\t    \t\tif (this.isediting) {\n\t\t    \t\t\tthis.updateWord();\n\t\t    \t\t}\n\t\t    \t}).bind(this));\n\t\t    \t\n\t\t    \t$(this.parent).on('click', '.wc_removeword', (function(event){\n\t\t    \t\tif (this.isediting) {\n\t\t    \t\t\tthis.removeWord();\n\t\t    \t\t\tthis.closeWordEdit();\n\t\t    \t\t}\n\t\t    \t}).bind(this));\n\t\t    \t\n\t\t    \tthis.parent.on('click', '.wc_closeedit', (function(event){\n\t\t    \t\tif (this.isediting) {\n\t\t    \t\t\tthis.closeWordEdit();\n\t\t    \t\t}\n\t\t    \t}).bind(this));\n\t\t    \t\n\t\t    \t\n\t\t    }\n\t\t}\n\t    \n\t    //Draw the word cloud\n\t    draw(words) {\n\t        var cloud = this.svg.selectAll(\"g text\").data(words, function(d) { return d.text; })\n\t        \n\t        //Entering words\n\t        cloud.enter()\n\t            .append(\"text\")\n\t            .style(\"font-family\", \"Impact\")\n\t            .style(\"fill\", function(d, i) { return fill(Math.random()); })\n\t            .attr(\"text-anchor\", \"middle\")\n\t            .attr('font-size', 1)\n\t            .text(function(d) { return d.text; });\n\t        \n\t        //Entering and existing words\n\t        cloud\n\t            .transition()\n\t                .duration(600)\n\t                .style(\"font-size\", function(d) { return d.size + \"px\"; })\n\t                .attr(\"transform\", function(d) {\n\t                    return \"translate(\" + [d.x, d.y] + \")rotate(\" + d.rotate + \")\";\n\t                })\n\t                .style(\"fill-opacity\", 1);\n\n\t        //Exiting words\n\t        cloud.exit()\n\t            .transition()\n\t                .duration(200)\n\t                .style('fill-opacity', 1e-6)\n\t                .attr('font-size', 1)\n\t                .remove();\n\t    }\n\n        update_svg() {\n        \tthis.wordsrender = JSON.parse(JSON.stringify(this.words));\n        \t\n            var cloud = d3.layout.cloud().size([this.width, this.height])\n                .words(this.wordsrender)\n                .padding(3)\n                .rotate(function() { return (~~(Math.random() * 2) * 90)-45; })\n                //.rotate(function() { return (~~(Math.random() * 2) * 90); })\n                //.rotate(function() { return (~~(Math.random() * 2) * 45); })\n                .font(\"Impact\")\n                .fontSize(function(d) { return d.size; })\n                .on(\"end\", this.draw.bind(this))\n                .start();\n        }\n        \n        resize(){\n        \tif (this.wcwidth != $(this.selector).parents('#region-main-box').width()) {\n        \t\tthis.wcwidth = $(this.selector).parents('#region-main-box').width();\n        \t\tthis.width = $(this.selector).parents('#region-main-box').width()-this.borderwidth;\n        \t\tthis.height = this.width*0.56;\n        \t\t\n        \t\tif (this.height > svgmaxheight) {\n        \t\t\tthis.height = svgmaxheight;\n        \t\t}else if (this.height < svgminheight) {\n        \t\t\tthis.height = svgminheight;\n        \t\t}\n\t        \t\n\t        \t$(this.selector).find(\"svg\").attr(\"width\", this.width)\n\t\t        .attr(\"height\", this.height).find(\"g\").attr(\"transform\", \"translate(\"+(this.width/2)+\",\"+(this.height/2)+\")\");;\n\t\t    \t\n\t\t        this.update_svg();\n        \t}\n\t    }\n\t    \n\t    changegroup(groupid) {\n\t\t\tif (this.currentgroupid != groupid) {\n\t\t\t\tthis.currentgroupid = groupid;\n\t\t\t\tthis.lastupdate = 0;\n\t\t\t\tthis.words = [];\n\t\t\t\tthis.wordsrender = [];\n\t\t\t\tvar newurl = window.location.protocol + \"//\" + window.location.host + window.location.pathname + '?id='+this.cmid+'&g='+groupid;\n\t\t\t\twindow.history.replaceState({path:newurl},document.title,newurl);\n\t\t\t\tthis.update_wordcloud();\n\t\t\t}\n\t\t}\n\t\t\n\t    displayaddform() {\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\": this.cmid, \"action\":\"getaddword\", \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\t\n\t            \t}else{\n\t            \t\t\n\t            \t}\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t    \n\t    switch_display(mod) {\n\t    \tif (this.displaymod == mod){\n\t\t\t\tif (mod == 'c') {\n\t\t\t\t\tif (this.editing) {\n\t\t\t\t\t\t$('.wc_tools').show();\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$('.wc_tools').hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t    \tif (mod == 'f') {\n\t    \t\tthis.displaymod = 'f';\n\t    \t\tif ($('.wordcloudcontainer').is(':visible')) {\n        \t\t\t$('.wordcloudcontainer').hide();\n        \t\t}\n\t    \t\tif (this.editing) {\n\t    \t\t\t$('.wc_tools').hide();\n\t    \t\t}\n        \t\tif (!$('#wcform').is(':visible')) {\n        \t\t\t$('#wcform').show();\n        \t\t}\n\t    \t}else{\n\t    \t\tthis.displaymod = 'c';\n\t    \t\tif ($('#wcform').is(':visible')) {\n        \t\t\t$('#wcform').html('');\n        \t\t\t$('#wcform').hide();\n        \t\t}\n    \t\t\tif (!$('.wordcloudcontainer').is(':visible')) {\n        \t\t\t$('.wordcloudcontainer').show();\n        \t\t}\n    \t\t\tif (this.editing) {\n    \t\t\t\t$('.wc_tools').show();\n    \t\t\t}\t\n    \t\t}\n\t    }\n\t\t\n\t\tupdate_wordcloud(force=false) {\n\t\t\tif (!force && this.isediting){return;}\n\t\t\tif (this.lastupdate == undefined){\n\t\t\t\tthis.lastupdate = 0;\n\t\t\t}\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\": this.cmid, \"action\":\"getdata\", \"groupid\":this.currentgroupid, \"lastupdate\":this.lastupdate}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\tif (response.mod=='c') {\n\t\t            \t\tif (response.noupdate==true) {\n\t\t            \t\t\tthis.updatedelay = this.updatedelay+delaystep;\n\t\t            \t\t}else{\n\t\t            \t\t\tif (this.parent.find('.wc_participation').length) {\n\t\t            \t\t\t\tif (response.subs == 0) {\n\t\t            \t\t\t\t\tstr.get_string('nosubmition','mod_wordcloud').then((value)=>{ this.parent.find('.wc_participation_count').text(value); });\n\t\t            \t\t\t\t}else if (response.subs == 1) {\n\t\t            \t\t\t\t\tstr.get_string('onesubmition','mod_wordcloud',response.subs).then((value)=>{this.parent.find('.wc_participation_count').text(value);})\n\t\t            \t\t\t\t}else{\n\t\t            \t\t\t\t\tstr.get_string('multi_submition','mod_wordcloud',response.subs).then((value)=>{this.parent.find('.wc_participation_count').text(value);})\n\t\t            \t\t\t\t}\n\t\t            \t\t\t}\n\t\t            \t\t\tthis.updatedelay = delaystep;\n\t\t            \t\t\tthis.lastupdate = response.timemodified;\n\t\t\t\t\t\t\t\tthis.editing = response.editor;\n\t\t            \t\t\tthis.words = response.words;\n\t\t            \t\t\tthis.switch_display('c');\n\t\t            \t\t\tthis.update_svg();\n\t\t            \t\t\tif (this.words.length == 0){\n\t\t            \t\t\t\t$('.wc_empty').show();\n\t\t            \t\t\t}else{\n\t\t            \t\t\t\t$('.wc_empty').hide();\n\t\t            \t\t\t}\n\t\t            \t\t}\n\t\t\t    \t\t\tif (this.updatetimer != undefined){\n\t\t\t    \t\t\t\tclearTimeout(this.updatetimer);\n\t\t\t    \t\t\t}\n\t\t\t    \t\t\tif (this.updatedelay < maxdelay) {\n\t\t\t    \t\t\t\tthis.updatetimer = setTimeout((function(){this.update_wordcloud();}).bind(this),this.updatedelay);\n\t\t\t    \t\t\t}\n\t            \t\t}else{\n\t            \t\t\tthis.switch_display('f');\n\t            \t\t\t$('#wcform').html(response.form);\n\t            \t\t}\n\t            \t}else{\n\t            \t\t\n\t            \t}\n\t            \t\n\t            \t\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t\t\n\t\texportPNG() {\n\t\t    d3.event.preventDefault();\n\t\t    //var fill = d3.scale.category20();\n\t\t    var t = document.createElement(\"canvas\")\n\t\t      , e = t.getContext(\"2d\");\n\t\t    t.width = this.width,\n\t\t    t.height = this.height,\n\t\t    e.translate(this.width >> 1, this.height >> 1),\n\t\t    //e.scale(scale, scale),\n\t\t    this.wordsrender.forEach(function(t, n) {\n\t\t        e.save(),\n\t\t        e.translate(t.x, t.y),\n\t\t        e.rotate(t.rotate * Math.PI / 180),\n\t\t        e.textAlign = \"center\",\n\t\t        e.fillStyle = fill(t.text.toLowerCase()),\n\t\t        e.font = t.size + \"px \" + t.font,\n\t\t        e.fillText(t.text, 0, 0),\n\t\t        e.restore()\n\t\t    });\n\t\t    var a = document.createElement(\"a\");\n\t\t    a.href = t.toDataURL(\"image/png\").replace(\"image/png\", \"image/octet-stream\");\n\t\t    a.download = \"export.png\";\n\t\t    a.click();\n\t\t}\n\t\t\n\t\texportData() {\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\":this.cmid, \"action\":\"exportdata\", \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\tvar a = document.createElement('a');\n\t            \t\tif (window.URL && window.Blob && ('download' in a) && window.atob) {\n\t            \t\t    var blob = base64ToBlob(response.data, 'text/octet-stream');\n\t            \t\t    var url = window.URL.createObjectURL(blob);\n\t            \t\t    a.href = url;\n\t            \t\t    a.download = 'export.csv';\n\t            \t\t    a.click();\n\t            \t\t    window.URL.revokeObjectURL(url);\n\t            \t\t}\n            \t\t\t\n\t            \t}else{\n\t            \t\t\n\t            \t}\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t\t\n\t\taddWord() {\n\t\t\t$(this.parent).find('input[name=\"wcaddword\"]').prop(\"disabled\",true);\n\t\t\t$(this.parent).find('.wc_addword').prop(\"disabled\",true);\n\t\t\tvar word = $(this.parent).find('input[name=\"wcaddword\"]').val();\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\":this.cmid, \"action\":\"addword\", \"word\":word, \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\tthis.update_wordcloud();\n\t            \t}else{\n\t            \t}\n\t            \t$(this.parent).find('input[name=\"wcaddword\"]').prop(\"disabled\",false);\n\t    \t\t\t$(this.parent).find('.wc_addword').prop(\"disabled\",false);\n\t    \t\t\t$(this.parent).find('input[name=\"wcaddword\"]').val('');\n\t    \t\t\t$(this.parent).find('input[name=\"wcaddword\"]').focus();\n\t            }).bind(this),\n\t            error: (function (error) {\n\t            \t$(this.parent).find('input[name=\"wcaddword\"]').prop(\"disabled\",false);\n\t    \t\t\t$(this.parent).find('.wc_addword').prop(\"disabled\",false);\n\t    \t\t\t$(this.parent).find('input[name=\"wcaddword\"]').val('');\n\t    \t\t\t$(this.parent).find('input[name=\"wcaddword\"]').focus();\n\t            }).bind(this)\n\t        });\n\t\t}\n\t\t\n\t\tloadWordEdit(word) {\n\t\t\tthis.isediting = true;\n\t\t\tthis.editingword = word;\n\t\t\t$(this.selector).addClass('locked');\n\t\t\tthis.parent.find('.wc_groupselector').prop('disabled', true);\n\t\t\t\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\":this.cmid, \"action\":\"getwordinfo\", \"word\":word, \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\t\n\t            \t\tthis.parent.find('input[name=wceditword]').val(response.word);\n\t            \t\tthis.parent.find('.wc_weight span').text(response.weight);\n\t            \t\t\n\t            \t\tvar ul = this.parent.find('.wc_users ul');\n\t            \t\tul.html('');\n\t            \t\t\n\t            \t\t$(response.users).each(function(idx,val){\n\t            \t\t\tul.append('<li>'+val+'</li>');\n\t            \t\t});\n\t            \t\t\n\t            \t\tthis.parent.find('.wc_tools').slideUp(500);\n\t            \t\tthis.parent.find('.wc_editor_word').slideDown(500);\n\t            \t\t\n\t            \t}else{\n\t            \t}\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t\t\n\t\tcloseWordEdit() {\n\t\t\tthis.isediting = false;\n\t\t\tthis.editingword = '';\n    \t\tthis.parent.find('input[name=wceditword]').val('');\n    \t\tthis.parent.find('.wc_weight span').text('');\n    \t\t\n    \t\tvar ul = this.parent.find('.wc_users ul');\n    \t\tul.html('');\n    \t\t\n    \t\tthis.parent.find('.wc_tools').slideDown(500);\n    \t\tthis.parent.find('.wc_editor_word').slideUp(500);\n    \t\t$(this.selector).removeClass('locked');\n    \t\tthis.parent.find('.wc_groupselector').prop('disabled', false);\n\t\t}\n\n\t\t\n\t\tupdateWord() {\n\t\t\tvar newword = this.parent.find('input[name=wceditword]').val();\n\t\t\t\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\":this.cmid, \"action\":\"updateword\", \"word\":this.editingword, \"newword\":newword, \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\t\n\t            \t\tthis.lastupdate=0;\n\t            \t\tthis.update_wordcloud(true);\n\t            \t\tthis.loadWordEdit(newword);\n\t            \t}else{\n\t            \t}\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t\t\n\t\tremoveWord() {\n\t\t\t$.ajax({\n\t            type: 'POST',\n\t            url: apiurl,\n\t            data: JSON.stringify({\"cmid\":this.cmid, \"action\":\"removeword\", \"word\":this.editingword, \"groupid\":this.currentgroupid}),\n\t            dataType: 'json',\n\t            success: (function (response) {\n\t            \tif (response.error==false) {\n\t            \t\t\n\t            \t\tthis.lastupdate=0;\n\t            \t\tthis.update_wordcloud();\n\t            \t}else{\n\t            \t}\n\t            }).bind(this),\n\t            error: function (error) {\n\t            }\n\t        });\n\t\t}\n\t}\n\t\n\tfunction base64ToBlob(base64, mimetype, slicesize) {\n\t    if (!window.atob || !window.Uint8Array) {\n\t        return null;\n\t    }\n\t    mimetype = mimetype || '';\n\t    slicesize = slicesize || 512;\n\t    var bytechars = atob(base64);\n\t    var bytearrays = [];\n\t    for (var offset = 0; offset < bytechars.length; offset += slicesize) {\n\t        var slice = bytechars.slice(offset, offset + slicesize);\n\t        var bytenums = new Array(slice.length);\n\t        for (var i = 0; i < slice.length; i++) {\n\t            bytenums[i] = slice.charCodeAt(i);\n\t        }\n\t        var bytearray = new Uint8Array(bytenums);\n\t        bytearrays[bytearrays.length] = bytearray;\n\t    }\n\t    return new Blob(bytearrays, {type: mimetype});\n\t};\n\t\n\treturn {\n\t\tshowWordcloud : function(cmid,selector, apiurl, editor){\n        \tshowWordcloud(cmid, selector, apiurl, editor);\n        }\n    };\n});\n"],"file":"wordcloud.min.js"}